(function(t){function e(e){for(var a,r,s=e[0],h=e[1],c=e[2],d=0,u=[];d<s.length;d++)r=s[d],n[r]&&u.push(n[r][0]),n[r]=0;for(a in h)Object.prototype.hasOwnProperty.call(h,a)&&(t[a]=h[a]);l&&l(e);while(u.length)u.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],a=!0,s=1;s<i.length;s++){var h=i[s];0!==n[h]&&(a=!1)}a&&(o.splice(e--,1),t=r(r.s=i[0]))}return t}var a={},n={index:0},o=[];function r(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=a,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(i,a,function(e){return t[e]}.bind(null,a));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],h=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var l=h;o.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("c31f")},"42b1":function(t,e,i){"use strict";var a=i("880c"),n=i.n(a);n.a},"880c":function(t,e,i){},"8f31":function(t,e,i){},a058:function(t,e,i){},bc71:function(t,e,i){"use strict";var a=i("8f31"),n=i.n(a);n.a},c31f:function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var a=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[t._v("\n   顶部\n      "),i("p",{staticClass:"watermark"},[i("span",[t._v("输入水印文字：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.textWatermark,expression:"textWatermark"}],attrs:{type:"text",placeholder:"可以输入水印"},domProps:{value:t.textWatermark},on:{input:function(e){e.target.composing||(t.textWatermark=e.target.value)}}})]),i("p",{staticClass:"watermark"},[i("span",[t._v("输入水印颜色：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.color,expression:"color"}],attrs:{type:"text",placeholder:"可以输入水印"},domProps:{value:t.color},on:{input:function(e){e.target.composing||(t.color=e.target.value)}}})]),i("p",{staticClass:"range"},[i("span",[t._v("水印X方位："+t._s(t.option[0])+"%")]),i("range",{attrs:{min:0,max:100,step:1,"bar-height":2},model:{value:t.option[0],callback:function(e){t.$set(t.option,0,e)},expression:"option[0]"}})],1),i("p",{staticClass:"range"},[i("span",[t._v("水印Y方位："+t._s(t.option[1])+"%")]),i("range",{attrs:{min:0,max:100,step:1,"bar-height":2},model:{value:t.option[1],callback:function(e){t.$set(t.option,1,e)},expression:"option[1]"}})],1),i("p",{staticClass:"range"},[i("span",[t._v("水印大小："+t._s(t.option[2]))]),i("range",{attrs:{min:0,max:100,step:1,"bar-height":2},model:{value:t.option[2],callback:function(e){t.$set(t.option,2,e)},expression:"option[2]"}})],1),i("p",{staticClass:"range"},[i("span",[t._v("水印旋转角度："+t._s(t.option[3])+"°")]),i("range",{attrs:{min:0,max:360,step:1,"bar-height":2},model:{value:t.option[3],callback:function(e){t.$set(t.option,3,e)},expression:"option[3]"}})],1),i("p",{staticClass:"operation"},[i("button",{class:{blue:"save"==t.shape},on:{click:function(e){t.shape="save"}}},[t._v("整图片裁剪")]),i("button",{class:{blue:"rect"==t.shape},on:{click:function(e){t.shape="rect"}}},[t._v("矩形裁剪框")]),i("button",{class:{blue:"arc"==t.shape},on:{click:function(e){t.shape="arc"}}},[t._v("圆形裁剪框")]),i("br"),i("button",{staticClass:"blue",on:{click:function(e){return t.crop.changeImage()}}},[t._v("点我换图")]),i("button",{staticClass:"blue operationButton",on:{click:t.getImageData}},[t._v("生成图片")])]),i("crop",{staticStyle:{width:"100%",height:"300px","background-color":"#f1f3f5"},attrs:{position:t.option,textWatermark:t.textWatermark,angle:15,imageWatermark:t.imgWatermark,color:t.color,shape:t.shape},model:{value:t.crop,callback:function(e){t.crop=e},expression:"crop"}},[i("template",{slot:"placeholder"},[i("img",{staticStyle:{width:"20%"},attrs:{src:"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1057851374,249752393&fm=26&gp=0.jpg"}})])],2),i("v-dialog",{attrs:{visible:t.cropAction},on:{"update:visible":function(e){t.cropAction=e}}},[i("img",{attrs:{src:t.imageData,alt:"小程序码"}}),i("p",{attrs:{slot:"desc"},slot:"desc"},[i("span",[t._v("长按保存图片哦~")])])])],1)},o=[],r=(i("96cf"),i("3b8d")),s=(i("4917"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mt-range",class:{"mt-range--disabled":t.disabled}},[t._t("start"),i("div",{ref:"content",staticClass:"mt-range-content"},[i("div",{staticClass:"mt-range-runway",style:{"border-top-width":t.barHeight+"px"}}),i("div",{staticClass:"mt-range-progress",style:{width:t.progress+"%",height:t.barHeight+"px"}}),i("div",{ref:"thumb",staticClass:"mt-range-thumb",style:{left:t.progress+"%"},on:{touchstart:function(e){return t.start(e)},touchmove:function(e){return t.drag(e)},touchend:function(e){return t.end()}}})]),t._t("end")],2)}),h=[],c=(i("c5f6"),{name:"mt-range",props:{min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},disabled:{type:Boolean,default:!1},value:{type:Number},barHeight:{type:Number,default:1}},computed:{progress:function(){var t=this.value;return"undefined"===typeof t||null===t?0:Math.floor((t-this.min)/(this.max-this.min)*100)}},data:function(){return{thumb:null,content:null,dragState:{}}},methods:{start:function(t){if(!this.disabled){t=t.touches[0];var e=this.getThumbPosition(),i=t.clientX-e.thumbBoxLeft;this.dragState={thumbStartLeft:e.left,thumbStartTop:e.top,thumbClickDetalX:i}}},drag:function(t){if(!this.disabled){t=t.touches[0];var e=this.dragState,i=this.content.getBoundingClientRect(),a=t.pageX-i.left-e.thumbStartLeft-e.thumbClickDetalX,n=Math.ceil((this.max-this.min)/this.step),o=e.thumbStartLeft+a-(e.thumbStartLeft+a)%(i.width/n),r=o/i.width;r<0?r=0:r>1&&(r=1),this.$emit("input",Math.round(this.min+r*(this.max-this.min)))}},end:function(){this.disabled||(this.$emit("change",this.value),this.dragState={})},getThumbPosition:function(){var t=this.content.getBoundingClientRect(),e=this.thumb.getBoundingClientRect();return{left:e.left-t.left,top:e.top-t.top,thumbBoxLeft:e.left}}},mounted:function(){this.thumb=this.$refs.thumb,this.content=this.$refs.content}}),l=c,d=(i("bc71"),i("2877")),u=Object(d["a"])(l,s,h,!1,null,null,null),p=u.exports,g=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"dialog-fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"el-dialog__wrapper",on:{click:function(e){return e.target!==e.currentTarget?null:t.handleWrapperClick(e)},mousewheel:function(t){t.preventDefault(),t.stopPropagation()},touchmove:function(t){t.preventDefault(),t.stopPropagation()}}},[i("div",{ref:"dialog",staticClass:"el-dialog",class:[{"is-fullscreen":t.fullscreen,"el-dialog--center":t.center},t.customClass],style:t.style},[t.$slots.title?i("div",{staticClass:"el-dialog__header"},[t._t("title",[i("span",{staticClass:"el-dialog__title"},[t._v(t._s(t.title))])])],2):t._e(),t.rendered?i("div",{staticClass:"el-dialog__body"},[t._t("default")],2):t._e(),t.$slots.desc?i("div",{staticClass:"popupTips"},[t._t("desc")],2):t._e(),t.$slots.footer?i("div",{staticClass:"el-dialog__footer"},[t._t("footer")],2):t._e(),t.showClose?i("button",{staticClass:"el-dialog__closebtn",attrs:{type:"button","aria-label":"Close"},on:{click:t.handleClose}},[i("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]):t._e()])])])},f=[],m={name:"SignDialog",props:{visible:Boolean,closeOnClickModal:{type:Boolean,default:!0},title:{type:String,default:""},appendToBody:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},width:String,fullscreen:Boolean,customClass:{type:String,default:""},top:{type:String,default:"15vh"},beforeClose:Function,center:{type:Boolean,default:!0}},data:function(){return{closed:!1,rendered:-1,mask:""}},watch:{visible:function(t){var e=this;if(t){this.closed=!1,this.$nextTick(function(){e.$refs.dialog.scrollTop=0}),this.appendToBody&&document.body.appendChild(this.$el);var i=document.createElement("div");i.className="modal",document.body.appendChild(i),this.mask=i}else this.closed||this.$emit("close"),this.mask.parentNode.removeChild(this.mask)}},computed:{style:function(){var t={};return this.fullscreen||(t.marginTop=this.top,this.width&&(t.width=this.width)),t}},methods:{handleWrapperClick:function(){this.closeOnClickModal&&this.handleClose()},handleClose:function(){"function"===typeof this.beforeClose?this.beforeClose(this.hide):this.hide()},hide:function(t){!1!==t&&(this.$emit("update:visible",!1),this.$emit("close"),this.closed=!0)},afterLeave:function(){this.$emit("closed")}},mounted:function(){if(this.visible){this.rendered=!0,this.appendToBody&&document.body.appendChild(this.$el);var t=document.createElement("div");t.className="modal",document.body.appendChild(t),this.mask=t}},destroyed:function(){this.appendToBody&&this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)}},v=m,x=(i("f72a"),Object(d["a"])(v,g,f,!1,null,null,null)),y=x.exports,w={name:"app",data:function(){return{option:[50,50,2,0],color:"#f60",imgWatermark:"",textWatermark:"板蓝根出品，必属精品",crop:{},cropAction:!1,imageData:null,shape:"arc",rangeValue:50}},components:{range:p,"v-dialog":y},created:function(){this.isMobile()||alert("暂不支持pc")},methods:{uploadImg:function(t){this.imgWatermark=t.target.files[0]},isMobile:function(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)},getImageData:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.crop.getImage("Base64","image/png",2);case 2:e=t.sent,this.imageData=e,this.imageData&&(this.cropAction=!0);case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()}},b=w,k=(i("42b1"),Object(d["a"])(b,n,o,!1,null,null,null)),C=k.exports,P=(i("7f7f"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"mountNode",staticClass:"mount-node",staticStyle:{overflow:"hidden"},on:{touchstart:function(e){return t.handleStart(e)},touchmove:function(e){return t.handleMove(e)},touchend:function(e){return t.handleEnd(e)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.noImage,expression:"noImage"}],staticClass:"no-image-file",staticStyle:{height:"100%",display:"flex","justify-content":"center","align-items":"center","flex-wrap":"wrap"},on:{click:t.inputHandle,touchstart:function(t){t.stopPropagation()},touchmove:function(t){t.stopPropagation()}}},[t._t("placeholder",[i("span",[t._v("暂时没有图片,请选择图像")])]),i("div",{staticStyle:{display:"none"}},[i("input",{attrs:{type:"file",id:"file-input",accept:"image/jpeg,image/x-icon,image/png"},on:{change:t.uploadImg}}),t._t("defaultImgUrl")],2)],2)])}),M=[],I=(i("6b54"),i("e814")),S=i.n(I),_=i("768b"),B=i("795b"),R=i.n(B),W=i("cebc"),T=(i("6c7b"),i("ac6a"),{name:"crop",props:["value","position","textWatermark","imageWatermark","defaultImgUrl","color","angle","shape"],data:function(){return{noImage:!0,ctx:null,options:null,pixelRatio:null,scale:1,canvas:null,image:{},points:[],lines:[],cropper:{},corePoint:{},startPoint:{},touchBar:{},nookSide:15,rotateAngle:0}},watch:{shape:function(){this.noImage||this.draw()}},methods:{init:function(t){this.pointList=[];var e=t.width,i=t.height,a=this.options,n=a.width,o=a.height,r=e,s=i,h=1;e>n&&(r=n,h=r/e,s=h*i),s>o&&(s=o,h=s/i,r=h*e);var c=100;e<c&&(r=c,h=r/e,s=h*i),s<c&&(s=c,h=s/i,r=h*e),this.scale=h,this.image={element:t,width:r,height:s,x:(n-r)/2,y:(o-s)/2,clientWidth:e,clientHeight:i};var l=this.corePoint={x:n/2,y:o/2};this.maxRadius=Math.min(n,o)/2,this.arc={x:l.x,y:l.y,r:this.maxRadius/2},this.cropper={x:(n-r/2)/2,y:(o-s/2)/2,width:r/2,height:s/2},this.touchBar={x:n-30-7,y:10,width:30,height:30},this.revokeBar={x:n-30-7,y:40,width:30,height:30},this.draw()},draw:function(){var t=this.options,e=t.width,i=t.height,a=this.shape||"rect";this.ctx.clearRect(0,0,e,i),this.fillBackground(),this.fillImage(),this.averageColor||(this.averageColor=this.getImageColor(this.ctx.getImageData(this.corePoint.x-25,this.corePoint.y-25,50,50).data)),"arc"===a?this.fillArcCropper():(this.updatePoint(),this.fillRectCropper()),this.angle&&(this.drawTouchBar(this.touchBar),this.drawTouchBar(this.revokeBar)),this.drawPointFn(this.ctx)},drawPointFn:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.image,n=this.pointList,o="arc"===this.shape?{x:this.arc.x-this.arc.r,y:this.arc.y-this.arc.r,width:2*this.arc.r,height:2*this.arc.r}:this.cropper;n.length>0&&n.forEach(function(n){var r=e.scale/n.scale;t.lineWidth=n.lineWidth,t.strokeStyle=n.color,t.lineCap="round",t.beginPath(),n.pointLine.forEach(function(e,n){0===n&&(i?t.moveTo((a.x+e.x*r-o.x)*i,(a.y+e.y*r-o.y)*i):t.moveTo(a.x+e.x*r,a.y+e.y*r)),i?t.lineTo((a.x+e.x*r-o.x)*i,(a.y+e.y*r-o.y)*i):t.lineTo(a.x+e.x*r,a.y+e.y*r)}),t.stroke()})},drawController:function(t){var e=this.ctx,i=this.color||this.averageColor,a=t.x+.6*t.width,n=t.y+.64*t.height,o=.41*t.width,r=6,s=.1*t.width,h=.18*t.width;if(e.lineWidth=2,e.fillStyle=i,e.fillRect(a-t.width/6,n-t.height/6,.43*t.width,.43*t.height),e.strokeStyle=i,e.beginPath(),e.arc(a,n,o,Math.PI/180*180,-Math.PI/2+r,!1),e.stroke(),r<2*Math.PI){var c=a+(o-s)*Math.sin(r),l=n-(o-s)*Math.cos(r),d=a+(o+s)*Math.sin(r),u=n-(o+s)*Math.cos(r),p=(c+d)/2+h*Math.sin(r+Math.PI/2),g=(l+u)/2-h*Math.cos(r+Math.PI/2);e.beginPath(),e.moveTo(p,g),e.lineTo(c,l),e.lineTo(d,u),e.fill()}},drawRevokeBar:function(t){var e=this.ctx,i=this.color||this.averageColor,a=t.x+.6*t.width,n=t.y+.64*t.height,o=.41*t.width,r=6,s=.1*t.width,h=.18*t.width;if(e.lineWidth=2,e.fillStyle=i,e.fillRect(a-t.width/6,n-t.height/6,.43*t.width,.43*t.height),e.strokeStyle=i,e.beginPath(),e.arc(a,n,o,Math.PI/180*180,-Math.PI/2+r,!1),e.stroke(),r<2*Math.PI){var c=a+(o-s)*Math.sin(r),l=n-(o-s)*Math.cos(r),d=a+(o+s)*Math.sin(r),u=n-(o+s)*Math.cos(r),p=(c+d)/2+h*Math.sin(r+Math.PI/2),g=(l+u)/2-h*Math.cos(r+Math.PI/2);e.beginPath(),e.moveTo(p,g),e.lineTo(c,l),e.lineTo(d,u),e.fill()}},drawTouchBar:function(t){var e=this.ctx,i=this.color||this.averageColor,a=t.x+.6*t.width,n=t.y+.64*t.height,o=.41*t.width,r=6,s=.1*t.width,h=.18*t.width;if(e.lineWidth=1,e.fillStyle=i,e.fillRect(a-t.width/6,n-t.height/6,.43*t.width,.43*t.height),e.strokeStyle=i,e.beginPath(),e.arc(a,n,o,Math.PI/180*180,-Math.PI/2+r,!1),e.stroke(),r<2*Math.PI){var c=a+(o-s)*Math.sin(r),l=n-(o-s)*Math.cos(r),d=a+(o+s)*Math.sin(r),u=n-(o+s)*Math.cos(r),p=(c+d)/2+h*Math.sin(r+Math.PI/2),g=(l+u)/2-h*Math.cos(r+Math.PI/2);e.beginPath(),e.moveTo(p,g),e.lineTo(c,l),e.lineTo(d,u),e.fill()}},fillImage:function(){var t=this.image,e=this.ctx,i=this.rotateAngle;this.canvasRotate("img",e,t.element,i,t.x,t.y,t.width,t.height)},updatePoint:function(){var t=this.cropper,e=this.nookSide,i=t.x+t.width,a=t.y+t.height,n=i-e,o=a-e;this.points=[{x:t.x,y:t.y,width:e,height:e,diffX:0,diffY:0},{x:n,y:t.y,width:e,height:e,diffX:e,diffY:0},{x:n,y:o,width:e,height:e,diffX:e,diffY:e},{x:t.x,y:o,width:e,height:e,diffX:0,diffY:e}];var r=e/.7,s=r/2;this.lines=[{x:t.x,y:t.y-s,width:t.width,height:r},{x:i-s,y:t.y,width:r,height:t.height},{x:t.x,y:a-s,width:t.width,height:r},{x:t.x-s,y:t.y,width:r,height:t.height}]},fillRectCropper:function(){var t=this.ctx,e=this.cropper,i=this.points,a=this.color||this.averageColor;t.strokeStyle=a,t.lineWidth=2,t.strokeRect(e.x,e.y,e.width,e.height),t.fillStyle=a;var n=this.nookSide/8;i.forEach(function(e,i){t.save(),t.translate(e.x+e.diffX,e.y+e.diffY),t.rotate(90*i*(Math.PI/180)),t.fillRect(-n,-n,e.height,2*n),t.fillRect(-n,-n,2*n,e.width),t.restore()})},fillArcCropper:function(){var t=this.ctx;t.beginPath(),t.strokeStyle=this.color||this.averageColor,t.lineWidth=2,t.arc(this.arc.x,this.arc.y,this.arc.r,0,2*Math.PI),t.stroke()},handleArcMove:function(t){var e=t.x,i=t.y;this.arc.r=this.limit(this.getDistance({pageX:e,pageY:i},{pageX:this.arc.x,pageY:this.arc.y}),2*this.nookSide,this.maxRadius),this.draw()},fillBackground:function(){var t=this.options,e=t.width,i=t.height,a=this.ctx,n=15,o=Math.ceil(e/n),r=Math.ceil(i/n);a.save(),a.fillStyle="#ccc";for(var s=0;s<r;s++)for(var h=0;h<o;h++)(h+s)%2===0&&a.fillRect(h*n,s*n,n,n);a.fillStyle="rgba(0, 0, 0, .1)",a.fillRect(0,0,e,i),a.restore()},getNewCropper:function(t,e,i){return{cropperWidth:i.x+i.width-t,cropperHeight:i.y+i.height-e,cropperX:t-i.x,cropperY:e-i.y}},handlePointMove:function(t){var e=t.x,i=t.y,a=this.cropper,n={},o=this.getNewCropper(e,i,a),r=o.cropperWidth,s=o.cropperHeight,h=o.cropperX,c=o.cropperY;switch(this.index){case 0:n.width=r,n.height=s,n.x=e,n.y=i;break;case 1:n.width=h,n.height=s,n.y=i;break;case 3:n.width=r,n.height=c,n.x=e;break;case 2:n.width=h,n.height=c;break;default:break}this.renderCropper(n)},handleLineMove:function(t){var e=t.x,i=t.y,a=this.cropper,n={},o=this.getNewCropper(e,i,a),r=o.cropperWidth,s=o.cropperHeight,h=o.cropperX,c=o.cropperY;switch(this.index){case 3:n.width=r,n.x=e;break;case 0:n.height=s,n.y=i;break;case 1:n.width=h;break;case 2:n.height=c;break;default:break}this.renderCropper(n)},renderCropper:function(t){t.width<=4*this.nookSide||t.height<=4*this.nookSide||(this.cropper=Object(W["a"])({},this.cropper,t),this.draw())},handleImageMove:function(t){var e=t.x,i=t.y,a=this.startPoint;this.image.x=e-a.offsetX,this.image.y=i-a.offsetY,this.draw()},getCoordinateByEvent:function(t){var e=t.target.getBoundingClientRect(),i=t.touches[0],a=this.options,n=a.width,o=a.height,r={x:this.limit(i.clientX-e.left,2,n-2),y:this.limit(i.clientY-e.top,2,o-2)};return r},handleEnd:function(){if(this.drawAction&&this.pointLine.length>0){this.drawPoint.x=this.drawPoint.x-this.image.x,this.drawPoint.y=this.drawPoint.y-this.image.y,this.pointLine.push(this.drawPoint);var t={pointLine:this.pointLine,scale:this.scale,lineWidth:5,color:"#f60"};this.pointList.push(t),this.pointLine=[]}},handleStart:function(t){if(t.preventDefault(),t.touches.length>1)return this.startTouches=t.touches,void(this.startPoint.type=null);this.drawPoint=this.getCoordinateByEvent(t),this.startPoint=this.getPointByCoordinate(this.drawPoint),this.drawAction&&(this.pointLine=[],this.ctx.beginPath(),this.ctx.moveTo(this.drawPoint.x,this.drawPoint.y))},handleMove:function(t){t.preventDefault();var e=t.touches,i=this.image;if(e.length>1){var a,n=this.startTouches,o=this.scale;a=this.getDistance(e[0],e[1])/this.getDistance(n[0],n[1]),a=a<1?1/(1+a/80):1+Math.abs(a)/160,a*=o,this.scale=this.limit(a,.02,4);var r=i.clientWidth*this.scale,s=i.clientHeight*this.scale;return this.image.x+=(i.width-r)/2,this.image.y+=(i.height-s)/2,this.image.width=r,this.image.height=s,void this.draw()}if(this.drawAction){var h=this.drawPoint,c=this.getCoordinateByEvent(t),l=this.ctx;return l.lineTo(c.x,c.y),l.lineWidth=5,l.strokeStyle="#f60",l.lineCap="round",l.stroke(),h.x=h.x-i.x,h.y=h.y-i.y,this.pointLine.push(h),void(this.drawPoint=c)}var d=this.startPoint.type;d&&this.getCoordinateByEvent(t)&&this[d](this.getCoordinateByEvent(t))},checkRegion:function(t,e,i){return t>i.x&&t<i.x+i.width&&e>i.y&&e<i.y+i.height},checkArc:function(t,e){var i=this.ctx;return i.beginPath(),i.lineWidth=this.nookSide/.7,i.arc(this.arc.x,this.arc.y,this.arc.r+i.lineWidth,0,2*Math.PI),i.isPointInPath(t*this.pixelRatio,e*this.pixelRatio)&&this.getDistance({pageX:t,pageY:e},{pageX:this.arc.x,pageY:this.arc.y})>this.arc.r-i.lineWidth/2},getPointByCoordinate:function(t){var e=this,i=t.x,a=t.y,n=this.image,o=this.touchBar,r=this.shape||"rect",s={},h=0;if(this.checkRegion(i,a,o))this.drawAction?(this.drawAction=!1,alert("取消划线"),console.log(this.pointList),alert(this.pointList.length)):(this.drawAction=!0,alert("开始划线"));else{if(this.checkRegion(i,a,this.revokeBar))return this.pointList.pop(),void this.draw();if(!this.drawAction)return"arc"===r&&this.checkArc(i,a)?s.type="handleArcMove":"arc"!==r&&this.points.some(function(t,n){return h=n,e.checkRegion(i,a,t)})?(s.type="handlePointMove",this.index=h):"arc"!==r&&this.lines.some(function(t,n){return h=n,e.checkRegion(i,a,t)})?(s.type="handleLineMove",this.index=h):this.checkRegion(i,a,n)&&(s.offsetX=i-n.x,s.offsetY=a-n.y,s.type="handleImageMove"),s}},getDistance:function(t,e){var i=e.pageX-t.pageX,a=e.pageY-t.pageY;return Math.sqrt(i*i+a*a)},limit:function(t,e,i){return t<e?e:t>i?i:t},getImage:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Base64",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!this.noImage){var n=this.image,o=this.shape||"rect",r="arc"===o?{x:this.arc.x-this.arc.r,y:this.arc.y-this.arc.r,width:2*this.arc.r,height:2*this.arc.r}:this.cropper,s=this.pixelRatio,h={Base64:function(t,e,i){i(t.toDataURL(e))},Blob:function(t,e,i){t.toBlob(function(t){i(t)},e)}},c=r.width*a,l=r.height*a;this.canvas||(this.canvas=document.createElement("canvas"),this.cCtx=this.canvas.getContext("2d"));var d=this.cCtx;this.canvas.width=c*s,this.canvas.height=l*s,d.scale(s,s),d.clearRect(0,0,c,l);var u=this.rotateAngle;if("arc"===o){var p=r.width;d.beginPath(),d.lineWidth=10,d.arc(p,p,p,0,2*Math.PI,!1),d.clip()}return this.canvasRotate("img",d,n.element,u,(n.x-r.x)*a,(n.y-r.y)*a,n.width*a,n.height*a),this.drawPointFn(this.cCtx,a,n),new R.a(function(n,o){if(h[e]){var r=Object(_["a"])(t.position,4),s=r[0],u=void 0===s?"50%":s,p=r[1],g=void 0===p?"50%":p,f=r[2],m=void 0===f?1:f,v=r[3],x=void 0===v?0:v;if(t.imageWatermark){var y=new Image;return y.src=t.getFileSrc(t.imageWatermark),y.crossOrigin="anonymous",void(y.onload=function(){var o=y.width*m*a/100,r=y.height*m*a/100,s=(c-o)*S()(u)/100,p=(l-r)*S()(g)/100;t.canvasRotate("img",d,y,x,s,p,o,r),h[e](t.canvas,i,n)})}if(t.textWatermark){var w=t.limit(12*m,12,100);d.font=w+"px Georgia";var b=t.textWatermark,k=d.measureText(b).width,C=(c-1.031*k)*S()(u)/100,P=(l+.72*w)*S()(g)/100;return d.fillStyle=t.color||t.averageColor,"#ffffff"===d.fillStyle&&(d.fillStyle="#000"),t.canvasRotate("text",d,b,x,C,P,k,w),void h[e](t.canvas,i,n)}h[e](t.canvas,i,n)}else o("type = Blob || Base64")})}},canvasRotate:function(t,e,i,a,n,o,r,s){e.save();var h=s/2,c=r/2;e.translate(n+c,o+h),e.rotate(Math.PI/180*a),"img"===t?e.drawImage(i,-c,-h,r,s):e.fillText(i,-c,-h),e.restore()},changeImage:function(t){this.noImage||(this.averageColor=null,t?this.createImage(t):this.inputHandle())},getPixelRatio:function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},uploadImg:function(t){this.createImage(t.target.files[0]),this.noImage=!1},getFileSrc:function(t){return"[object File]"===Object.prototype.toString.call(t)&&(t=window.URL.createObjectURL(t)),t},createImage:function(t){var e=this,i=new Image;i.crossOrigin="anonymous",i.src=this.getFileSrc(t),i.onload=function(){e.init(i)}},inputHandle:function(){document.getElementById("file-input").click()},getImageColor:function(t){for(var e=0,i=0,a=0,n=50,o=0;o<n;o++)for(var r=0;r<n;r++)e+=t[4*(n*o+r)],i+=t[4*(n*o+r)+1],a+=t[4*(n*o+r)+2];return e/=n*n,i/=n*n,a/=n*n,e=Math.round(e),i=Math.round(i),a=Math.round(a),"rgba(".concat(255-e,", ").concat(255-i,", ").concat(255-a,", 1)")}},mounted:function(){var t=this.$refs.mountNode,e=t.clientWidth,i=t.clientHeight;this.options={width:e,height:i};var a=document.createElement("canvas");a.style.width=e+"px",a.style.height=i+"px",t.appendChild(a),this.ctx=a.getContext("2d");var n=this.pixelRatio=this.getPixelRatio(this.ctx);if(a.width=e*n,a.height=i*n,this.ctx.scale(n,n),this.defaultImgUrl||this.$slots.defaultImgUrl){var o=this.defaultImgUrl?this.defaultImgUrl:this.$slots.defaultImgUrl[0].data.attrs.src;this.createImage(o),this.noImage=!1}this.$emit("input",{getImage:this.getImage,changeImage:this.changeImage})}}),$=T,L=Object(d["a"])($,P,M,!1,null,null,null),O=L.exports,X=function t(e){t.installed||(t.installed=!0,e.component(O.name,O))};"undefined"!==typeof window&&window.Vue&&X(window.Vue);var j={install:X,crop:O};a["a"].use(j),a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(C)}}).$mount("#app")},f72a:function(t,e,i){"use strict";var a=i("a058"),n=i.n(a);n.a}});
//# sourceMappingURL=index.ae7b052d.js.map